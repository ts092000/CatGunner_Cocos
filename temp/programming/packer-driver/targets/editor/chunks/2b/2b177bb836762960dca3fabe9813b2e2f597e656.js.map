{"version":3,"sources":["file:///Users/ADMIN/Desktop/CatGunner_Github/CatGunner_Cocos/assets/Scripts/Game/JoystickController.ts"],"names":["_decorator","Camera","Component","Node","Vec2","Vec3","PlayerController","ccclass","property","JoystickController","type","v3","startPosMouse","maxR","playerControllerComponent","start","node","on","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","playerNode","getComponent","getContainerLocation","event","location","cameraGame","screenToWorld","getLocation","x","y","inverseTransformPoint","onTouchStart","console","log","newPos","len","Math","sqrt","stick","setPosition","checkDirection","position","rigidPlayer","linearVelocity","playIdleMove","update","dt"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Component, EventTouch, math, Node, Vec2, Vec3 } from 'cc';\nimport { PlayerController } from './PlayerController';\nconst { ccclass, property } = _decorator;\n\n@ccclass('JoystickController')\nexport class JoystickController extends Component {\n    @property({type:Node})\n    public stick: Node;\n\n    @property({type:Camera})\n    public cameraGame: Camera;\n\n    @property({type:Node})\n    public playerNode: Node;\n\n    public v3: Vec3 = new Vec3();\n    private startPosMouse: Vec3 = new Vec3();\n    public maxR: number = 45;\n    public playerControllerComponent: any;\n    \n    protected start(): void {\n        // this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n\n        this.playerControllerComponent = this.playerNode.getComponent(PlayerController);\n    }\n\n    private getContainerLocation(event: EventTouch, node: Node): Vec3 {\n        let location = this.cameraGame.screenToWorld(new Vec3(event.getLocation().x, event.getLocation().y, 0));\n        node.inverseTransformPoint(this.v3, new Vec3(location.x, location.y));\n        return this.v3;\n    }\n\n    private onTouchStart(event: EventTouch) {\n        console.log('start');\n        const newPos = this.getContainerLocation(event, this.node)\n        let len: number = Math.sqrt(newPos.x * newPos.x + newPos.y * newPos.y);\n        if (len > this.maxR) {\n            newPos.x = newPos.x * this.maxR / len;\n            newPos.y = newPos.y * this.maxR / len;\n        }\n        this.stick.setPosition(newPos);\n        this.checkDirection();\n    }\n    \n    private onTouchMove(event: EventTouch) {\n        const newPos = this.getContainerLocation(event, this.node)\n        this.stick.setPosition(newPos);\n        let len: number = Math.sqrt(newPos.x * newPos.x + newPos.y * newPos.y);\n        if (len > this.maxR) {\n            newPos.x = newPos.x * this.maxR / len;\n            newPos.y = newPos.y * this.maxR / len;\n        }\n        this.stick.setPosition(newPos);\n        this.checkDirection();\n    }\n\n    private onTouchEnd(event: EventTouch) {\n        this.stick.position = new Vec3(0, 0);\n        this.playerControllerComponent.rigidPlayer.linearVelocity = new Vec2(0, 0);\n        this.playerControllerComponent.playIdleMove();\n    }\n\n    private checkDirection(): void {\n        if (this.stick.position.x <= 22.5 && this.stick.position.x > -22.5 && this.stick.position.y > 0 && this.stick.position.y <= 45) {\n            this.playerControllerComponent.rigidPlayer.linearVelocity = new Vec2(this.playerControllerComponent.rigidPlayer.linearVelocity.x, 7.5);\n        } else if (this.stick.position.x > 0 && this.stick.position.x <= 45 && this.stick.position.y > -22.5 && this.stick.position.y <= 22.5) {\n            this.playerControllerComponent.rigidPlayer.linearVelocity = new Vec2(7.5, this.playerControllerComponent.rigidPlayer.linearVelocity.y);\n        } else if (this.stick.position.x <= 22.5 && this.stick.position.x > -22.5 && this.stick.position.y < 0 && this.stick.position.y >= -45) {\n            this.playerControllerComponent.rigidPlayer.linearVelocity = new Vec2(this.playerControllerComponent.rigidPlayer.linearVelocity.x, -7.5);\n        } else if(this.stick.position.x < 0 && this.stick.position.x >= -45 && this.stick.position.y > -22.5 && this.stick.position.y <= 22.5) {\n            this.playerControllerComponent.rigidPlayer.linearVelocity = new Vec2(-7.5, this.playerControllerComponent.rigidPlayer.linearVelocity.y);\n        }\n    }\n\n    protected update(dt: number): void {\n        \n    }\n}\n\n\n"]}